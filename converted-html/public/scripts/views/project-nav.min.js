(function(e){e.App=e.App||{},App.Views=App.Views||{},App.Views.ProjectNav=Backbone.View.extend({el:document.getElementById("project-view"),projects:[],initialize:function(){_.bindAll(this,"onClick","show","loadProject","onProjectLoaded","onSliderAnimationComplete"),this.pagenav=new App.Views.PageNav,this.projects=_.map(this.el.querySelectorAll(".project-view-item"),function(e){var t=new App.Views.ProjectView({id:e.id,el:e});return t}),this.slider=new App.Views.Slider({animType:"slide",el:this.el,innerEl:document.getElementById("project-view-slider-inner")}),this.nextBtn=document.getElementById("btn-next"),this.prevBtn=document.getElementById("btn-prev"),this.el.addEventListener("click",this.onClick)},onClick:function(e){console.log(e);var t=e.target;t===this.nextBtn?this.next():t===this.prevBtn?this.prev():this.pagenav.contains(t)>-1&&this.setRoute(this.currentProject.id,this.pagenav.contains(t))},next:function(){var e=this.currentProject.getNext();e===!1?this.setRoute(this.getNextProject().id,0):this.setRoute(this.currentProject.id,e)},prev:function(){var e=this.currentProject.getPrev();if(e===!1){var t=this.getPrevProject();this.setRoute(t.id,t.getLength()-1)}else this.setRoute(this.currentProject.id,e)},setRoute:function(e,t){App.router.navigate("projects/"+e+"/"+t,{trigger:!0})},show:function(){this.el.classList.add("is-visible"),this.animate=!0,e.scrollTo(0,0)},hide:function(){this.pagenav.hide(),this.currentProject=void 0,this.animate=!1,this.el.classList.remove("is-visible")},navigateTo:function(e,t){if(this.pagenav.go(t),this.isCurrentProject(e))console.log("project already current, navigating to slide: "+t),this.currentProject.navigateTo(t,!0);else{var i=this.getProjectByID(e);i.loaded?(console.log("project already loaded but not current, navigating to project and slide: "+t),this.currentProject=i,i.navigateTo(t),this.goToProject(i,!0),this.trigger("loaded")):(console.log("project not loaded, loading: "),this.loadProject(e,t))}},loadProject:function(e,t){this.currentProject=this.getProjectByID(e),this.currentProject.on("loaded",this.onProjectLoaded),this.currentProject.load(t),App.eventDispatcher.trigger("progress:change",10)},onProjectLoaded:function(){this.currentProject.off("loaded"),this.goToProject(this.currentProject,this.animate),this.trigger("loaded")},getProjectByID:function(e){return _.find(this.projects,function(t){return t.id===e})},goToProject:function(e,t){this.slider.navigateTo(this.getProjectSlideIndex(e),t),t?(this.pagenav.hide(),this.slider.on("animationComplete",this.onSliderAnimationComplete)):(this.pagenav.render(this.currentProject.slider.length),_.delay(this.pagenav.show,1e3))},onSliderAnimationComplete:function(){this.pagenav.render(this.currentProject.slider.length),this.slider.off("animationComplete",this.onSliderAnimationComplete),_.delay(this.pagenav.show,1e3)},getProjectSlideIndex:function(e){return this.projects.indexOf(e||this.currentProject)},getNextProject:function(){return this.projects[this.getProjectSlideIndex()+1]||this.projects[0]},getPrevProject:function(){return this.projects[this.getProjectSlideIndex()-1]||this.projects[this.projects.length-1]},isCurrentProject:function(e){return!_.isUndefined(this.currentProject)&&this.currentProject.id===e}})}).call(this,window,Zepto);