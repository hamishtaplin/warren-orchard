window.App=window.App||{},function(t){var e={};e.Thumbnails=Backbone.View.extend({MAX_COLS:5,MAX_ROWS:3,MAX_THUMB_SIZE:400,el:"#thumbs",initialize:function(){_.bindAll(this,"drawGrid");var i=document.querySelectorAll(".thumb");this.numThumbs=i.length,this.progress=new e.ProgressBar({total:this.numThumbs}),this.queue=[],this.numLoaded=0,this.numPagesOfThumbs=0,this.thumbPages=[],this.thumbsInnerEl=document.createElement("div"),this.thumbsInnerEl.className="thumbs__inner",this.el.appendChild(this.thumbsInnerEl),this.thumbsPagingNav=document.createElement("nav"),this.thumbsPagingNav.className="thumbs__paging",this.el.parentElement.appendChild(this.thumbsPagingNav);for(var s=0;s<this.numThumbs;s++){var n=new e.Thumbnail({el:i[s],id:s});n.once("load",this.onThumbLoaded,this),this.queue.push(n)}parseFloat(t.getComputedStyle(document.body,null).getPropertyValue("font-size"));this.headerHeight=document.getElementById("header").offsetHeight,t.addEventListener("resize",_.bind(this.onWindowResize,this)),this.drawGrid()},onThumbLoaded:function(){this.numLoaded++,this.numLoaded===this.numThumbs?this.progress.complete():this.progress.render(this.numLoaded)},getStyleProp:function(e,i){return t.getComputedStyle?t.getComputedStyle(e,null).getPropertyValue(i):e.currentStyle?e.currentStyle[i]:void 0},drawGrid:function(){var e=t.innerWidth,i=t.innerHeight-2*this.headerHeight,s=parseInt(this.getStyleProp(this.queue[0].el,"max-width")),n=this.queue,h=this.numThumbs,a=this.el.style,l=0,o=0,r=0,d=0,u=0;if(cols=Math.ceil(e/s),rows=Math.ceil(i/s),cols>this.MAX_COLS&&(cols=this.MAX_COLS),rows>this.MAX_ROWS&&(rows=this.MAX_ROWS),l=cols*rows,o=Math.ceil(h/l),o!==this.numPagesOfThumbs){for(this.numPagesOfThumbs=o,u=0;o>u;u++)if("undefined"==typeof this.thumbPages[u]){var m=document.createElement("div");m.id="thumbs-page-"+u,m.className="thumbs__page",this.thumbPages[u]=m,this.thumbsInnerEl.appendChild(m)}for(u=0;h>u;u++){var g=n[u].el;g.style.width=100/cols+"%",g.style.height=100/rows+"%",this.thumbPages[Math.floor(u/l)].appendChild(g)}}for(r=i/rows*cols,d=i,a.width=r+"px",a.height=d+"px",u=0;o>u;u++)this.thumbPages[u].style.width=r+"px",this.thumbPages[u].style.height=d+"px";this.thumbsInnerEl.style.width=r*o+"px",this.thumbsInnerEl.style.height=d+"px"},onWindowResize:function(){this.drawGrid()}}),e.Thumbnail=Backbone.View.extend({initialize:function(){_.bindAll(this,"onImgLoad"),this.images=this.el.querySelectorAll(".thumb__img"),this.load()},load:function(){var t=this.images[0].getAttribute("data-src"),e=new Image;e.onload=_.bind(this.onImgLoad,this),e.setAttribute("src",t),e.src=t},onImgLoad:function(t){this.images[0].style.backgroundImage="url("+t.target.getAttribute("src")+")",this.el.classList.add("is-loaded"),this.trigger("load",this)}}),e.ProgressBar=Backbone.View.extend({id:"progress",initialize:function(t){var e=document.getElementById("global-wrapper");e.insertBefore(this.el,e.firstChild),this.innerEl=document.createElement("div"),this.el.classList.add("progress"),this.innerEl.classList.add("progress__bar"),this.el.appendChild(this.innerEl),this.total=t.total},render:function(t){var e=(t/this.total*100).toString()+"%";this.innerEl.style.width=e},complete:function(){this.render(this.total),t.setTimeout(_.bind(function(){this.el.classList.add("is-complete")},this),500)}});new e.Thumbnails}.call(this,window,Zepto),window.onload=function(){document.body.className+="loaded"};