(function(e){e.App=e.App||{},App.Views=App.Views||{},App.Views.ProjectNavView=Backbone.View.extend({tagName:"div",className:"project-view",projects:[],initialize:function(e){_.bindAll(this,"loadProject","onAjaxSuccess","show","onProjectImgsLoaded","onMainSliderPrev","onMainSliderNext","onSlideChanged","onBtnClick"),this.projectIDs=e.projectIDs,this.render()},render:function(){var e=document.getElementById("header");this.nextBtn=this.makeBtn("next"),this.prevBtn=this.makeBtn("prev"),this.innerEl=document.createElement("div"),this.innerEl.setAttribute("class","project-view-item-inner"),this.el.appendChild(this.innerEl);for(var t=0;t<this.projectIDs.length;t++){var i=this.projectIDs[t],r={id:i,el:document.createElement("div")};r.el.setAttribute("class","project-view-item"),r.el.setAttribute("id",i),this.projects.push(r),this.innerEl.appendChild(r.el)}e.parentNode.insertBefore(this.el,e.nextSibling),this.slider=new App.Views.Slider({animType:"slide",el:this.el,innerEl:this.innerEl})},makeBtn:function(e){var t=document.createElement("div");return t.className="bg-check  btn  btn-"+e,t.innerHTML=e,t.addEventListener("click",this.onBtnClick),this.el.appendChild(t),t},onBtnClick:function(e){e.target===this.nextBtn?this.currentProject.slider.next():e.target===this.prevBtn&&this.currentProject.slider.prev()},show:function(){this.el.classList.add("is-visible")},hide:function(){this.el.classList.remove("is-visible")},loadProject:function(e,t){console.log("load :"+e,t),this.currentProject=this.getProjectByID(e),Backbone.ajax({url:"/project-ajax",data:{id:e},success:_.bind(function(e){this.onAjaxSuccess(e,t)},this)})},onAjaxSuccess:function(e,t){this.currentProject.el.innerHTML=e,this.currentProject.imgLoader=new App.Views.ImageLoader({imgs:this.currentProject.el.querySelectorAll(".gallery-item"),useBg:!0}),this.currentProject.imgLoader.on("progress:complete",_.bind(function(){this.onProjectImgsLoaded(t)},this))},onProjectImgsLoaded:function(e){this.initProjectSlider(e),this.slider.navigateTo(this.projects.indexOf(this.currentProject),!0),this.trigger("loaded")},initProjectSlider:function(e){"undefined"==typeof this.currentProject.slider?this.currentProject.slider=new App.Views.Slider({animType:"fade",el:this.currentProject.el.querySelector(".gallery"),innerEl:this.currentProject.el.querySelector(".gallery-inner")}):this.currentProject.slider.navigateTo(e),this.currentProject.slider.on("slidechanged",this.onSlideChanged),this.currentProject.slider.on("navigate:next",this.onMainSliderNext),this.currentProject.slider.on("navigate:prev",this.onMainSliderPrev),BackgroundCheck.init({targets:".bg-check",images:".slider .img",debug:!1})},onMainSliderPrev:function(){this.unloadCurrentProject("prev")},onMainSliderNext:function(){this.unloadCurrentProject("next")},unloadCurrentProject:function(e){var t=0,i=this.projects.indexOf(this.currentProject);this.currentProject.imgLoader.off("progress:complete"),this.currentProject.slider.off("slidechanged"),this.currentProject.slider.off("navigate:next"),this.currentProject.slider.off("navigate:prev"),t="next"===e?i+1:i-1,this.trigger("route:project",this.projects[t].id)},onSlideChanged:function(e,t){this.trigger("route:project",this.currentProject.id,t)},getProjectByID:function(e){return _.find(this.projects,function(t){return t.id===e})}})}).call(this,window,Zepto);