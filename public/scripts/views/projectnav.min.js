(function(e){e.App=e.App||{},App.Views=App.Views||{},App.Views.ProjectNavView=Backbone.View.extend({tagName:"div",className:"project-view",projects:[],initialize:function(e){_.bindAll(this,"onClick","loadProject","onAjaxSuccess","show","onProjectLoaded"),this.projectIDs=e.projectIDs,this.render(),this.el.addEventListener("click",this.onClick)},render:function(){var e=document.getElementById("header");this.nextBtn=this.makeBtn("next"),this.prevBtn=this.makeBtn("prev"),this.innerEl=document.createElement("div"),this.innerEl.setAttribute("class","project-view-item-inner  will-animate"),this.el.appendChild(this.innerEl);for(var t=0;t<this.projectIDs.length;t++){var i=new App.Views.ProjectView({id:this.projectIDs[t],el:document.createElement("div")});i.on("loaded",this.onProjectLoaded),this.projects.push(i),this.innerEl.appendChild(i.el)}e.parentNode.insertBefore(this.el,e.nextSibling),this.slider=new App.Views.Slider({animType:"slide",el:this.el,innerEl:this.innerEl})},addUI:function(){var e=0,t=document.createElement("div");for(t.setAttribute("class","slider-paging-inner bg-check"),t.innerHTML="",this.pageNav=document.createElement("div"),this.pageNav.setAttribute("class","slider-paging"),this.pageNav.innerHTML="";e<this.numSlides;){var i=document.createElement("div");i.setAttribute("data-i",e.toString()),i.setAttribute("class","slider-paging-btn"),t.appendChild(i),e++}this.pageNav.inner=t,this.pageNav.appendChild(t),this.el.appendChild(this.pageNav)},makeBtn:function(e){var t=document.createElement("a");return t.className="bg-check  btn  btn-"+e,t.innerHTML=e,this.el.appendChild(t),t},onClick:function(e){var t=e.target;t===this.nextBtn?this.next():t===this.prevBtn&&this.prev()},next:function(){var e=this.currentProject.getNext();e===!1?this.setRoute(this.getNextProject().id,0):this.setRoute(this.currentProject.id,e)},prev:function(){var e=this.currentProject.getPrev();e===!1?this.setRoute(this.getPrevProject().id,0):this.setRoute(this.currentProject.id,e)},setRoute:function(e,t){App.router.navigate("projects/"+e+"/"+t,{trigger:!0})},show:function(){this.el.classList.add("is-visible")},hide:function(){this.currentProject=void 0,console.log("hide"),this.el.classList.remove("is-visible")},navigateTo:function(e,t){if(this.isCurrentProject(e))console.log("project already current, navigating to slide: "+t),this.currentProject.navigateTo(t);else{var i=this.getProjectByID(e);i.loaded?(console.log("project already loaded but not current, navigating to project and slide: "+t),this.currentProject=i,i.navigateTo(t),this.goToProject(i),this.trigger("loaded")):(console.log("project not loaded, loading: "),this.loadProject(e,t))}},loadProject:function(e,t){this.currentProject=this.getProjectByID(e),App.eventDispatcher.trigger("progress:change",10),Backbone.ajax({url:"/project-ajax",data:{id:e},success:_.bind(function(e){this.onAjaxSuccess(e,t)},this)})},onAjaxSuccess:function(e,t){this.currentProject.render(e,t)},onProjectLoaded:function(){this.goToProject(this.currentProject),this.trigger("loaded")},getProjectByID:function(e){return _.find(this.projects,function(t){return t.id===e})},goToProject:function(e){this.slider.navigateTo(this.getProjectSlideIndex(e))},getProjectSlideIndex:function(e){return this.projects.indexOf(e||this.currentProject)},getNextProject:function(){return console.log(this.projects[this.getProjectSlideIndex()+1]),this.projects[this.getProjectSlideIndex()+1]||this.projects[0]},getPrevProject:function(){return this.projects[this.getProjectSlideIndex()-1]||this.projects[this.projects.length-1]},isCurrentProject:function(e){return!_.isUndefined(this.currentProject)&&this.currentProject.id===e}})}).call(this,window,Zepto);