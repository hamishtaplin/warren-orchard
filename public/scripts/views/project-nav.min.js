(function(e){e.App=e.App||{},App.Views=App.Views||{},App.Views.ProjectNav=Backbone.View.extend({tagName:"div",className:"project-view",projects:[],initialize:function(e){_.bindAll(this,"onClick","loadProject","onAjaxSuccess","show","onProjectLoaded","onSliderAnimationComplete"),this.projectIDs=e.projectIDs,this.render(),this.el.addEventListener("click",this.onClick)},render:function(){var e=document.getElementById("header");this.pagenav=new App.Views.PageNav,this.nextBtn=this.makeBtn("next"),this.prevBtn=this.makeBtn("prev"),this.innerEl=document.createElement("div"),this.innerEl.setAttribute("class","project-view-item-inner  will-animate"),this.el.appendChild(this.innerEl);for(var t=0;t<this.projectIDs.length;t++){var i=new App.Views.ProjectView({id:this.projectIDs[t],el:document.createElement("div")});i.on("loaded",this.onProjectLoaded),this.projects.push(i),this.innerEl.appendChild(i.el)}e.parentNode.insertBefore(this.el,e.nextSibling),this.slider=new App.Views.Slider({animType:"slide",el:this.el,innerEl:this.innerEl}),this.el.insertBefore(this.pagenav.el,this.innerEl)},makeBtn:function(e){var t=document.createElement("a");return t.className="bg-check  btn  btn-"+e,t.innerHTML=e,this.el.appendChild(t),t},onClick:function(e){var t=e.target;t===this.nextBtn?this.next():t===this.prevBtn?this.prev():this.pagenav.contains(t)>-1&&this.setRoute(this.currentProject.id,this.pagenav.contains(t))},next:function(){var e=this.currentProject.getNext();e===!1?this.setRoute(this.getNextProject().id,0):this.setRoute(this.currentProject.id,e)},prev:function(){var e=this.currentProject.getPrev();if(e===!1){var t=this.getPrevProject();this.setRoute(t.id,t.getLength()-1)}else this.setRoute(this.currentProject.id,e)},setRoute:function(e,t){App.router.navigate("projects/"+e+"/"+t,{trigger:!0})},show:function(){this.el.classList.add("is-visible"),this.animate=!0},hide:function(){this.pagenav.hide(),this.currentProject=void 0,this.animate=!1,this.el.classList.remove("is-visible")},navigateTo:function(e,t){if(this.pagenav.go(t),this.isCurrentProject(e))console.log("project already current, navigating to slide: "+t),this.currentProject.navigateTo(t,!0);else{var i=this.getProjectByID(e);i.loaded?(console.log("project already loaded but not current, navigating to project and slide: "+t),this.currentProject=i,i.navigateTo(t),this.goToProject(i,!0),this.trigger("loaded")):(console.log("project not loaded, loading: "),this.loadProject(e,t))}},loadProject:function(e,t){this.currentProject=this.getProjectByID(e),App.eventDispatcher.trigger("progress:change",10),Backbone.ajax({url:"/project-ajax",data:{id:e},success:_.bind(function(e){this.onAjaxSuccess(e,t)},this)})},onAjaxSuccess:function(e,t){this.currentProject.render(e,t)},onProjectLoaded:function(){this.goToProject(this.currentProject,this.animate),this.trigger("loaded")},getProjectByID:function(e){return _.find(this.projects,function(t){return t.id===e})},goToProject:function(e,t){this.slider.navigateTo(this.getProjectSlideIndex(e),t),t?(this.pagenav.hide(),this.slider.on("animationComplete",this.onSliderAnimationComplete)):(this.pagenav.render(this.currentProject.slider.length),_.delay(this.pagenav.show,1e3))},onSliderAnimationComplete:function(){this.pagenav.render(this.currentProject.slider.length),this.slider.off("animationComplete",this.onSliderAnimationComplete),_.delay(this.pagenav.show,1e3)},getProjectSlideIndex:function(e){return this.projects.indexOf(e||this.currentProject)},getNextProject:function(){return this.projects[this.getProjectSlideIndex()+1]||this.projects[0]},getPrevProject:function(){return this.projects[this.getProjectSlideIndex()-1]||this.projects[this.projects.length-1]},isCurrentProject:function(e){return!_.isUndefined(this.currentProject)&&this.currentProject.id===e}})}).call(this,window,Zepto);